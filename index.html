<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SMAL EMPIRE | MAESTRO V7</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg: #040609; --card: #0d1117; --accent: #00ff59; --gold: #f5d033;
            --text: #ffffff; --text-dim: #8b949e; --border: #21262d; --red: #ff4747;
        }
        * { box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; transition: 0.2s; }
        body { background: var(--bg); color: var(--text); margin: 0; height: 100vh; display: flex; overflow: hidden; }
        
        /* Sidebar */
        aside.sidebar { width: 260px; background: var(--card); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 100; }
        .profile { padding: 30px; text-align: center; border-bottom: 1px solid var(--border); }
        #u-ava { width: 60px; height: 60px; background: var(--accent); color: #000; border-radius: 15px; display: flex; align-items: center; justify-content: center; margin: 0 auto 10px; font-weight: 900; font-size: 1.5rem; }
        nav .nav-item { padding: 15px 25px; cursor: pointer; color: var(--text-dim); display: flex; align-items: center; gap: 10px; font-weight: 600; border-left: 4px solid transparent; }
        nav .nav-item:hover, nav .nav-item.active { background: #161b22; color: var(--accent); border-left-color: var(--accent); }

        /* Main */
        main.main { flex: 1; overflow-y: auto; padding: 40px; background: radial-gradient(circle at top, #112211, #040609); }
        .view { display: none; max-width: 1000px; margin: 0 auto; animation: fadeIn 0.3s ease; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Estilos de Componentes */
        .glass-card { background: rgba(13, 17, 23, 0.8); border: 1px solid var(--border); border-radius: 20px; padding: 25px; margin-bottom: 20px; }
        .btn { padding: 12px 20px; border: none; border-radius: 8px; font-weight: 800; cursor: pointer; text-transform: uppercase; }
        .btn-accent { background: var(--accent); color: #000; }
        .btn-gold { background: var(--gold); color: #000; }
        .btn-red { background: var(--red); color: #fff; }
        
        input, select { background: #000; border: 1px solid var(--border); color: #fff; padding: 10px; border-radius: 8px; margin: 5px 0; width: 100%; }

        /* Grid de Juegos */
        .game-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .game-card { text-align: center; cursor: pointer; border: 2px solid transparent; }
        .game-card:hover { border-color: var(--accent); transform: scale(1.02); }

        /* Especial Juegos */
        #game-area { text-align: center; }
        .mines-board { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; max-width: 400px; margin: 20px auto; }
        .tile { width: 70px; height: 70px; background: var(--border); border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .tile.safe { background: var(--accent); color: #000; }
        .tile.bomb { background: var(--red); }
        
        .slot-reels { display: flex; justify-content: center; gap: 15px; font-size: 4rem; margin: 20px 0; }
        .reel { background: #000; padding: 20px; border-radius: 10px; border: 2px solid var(--gold); min-width: 100px; }
    </style>
</head>
<body>

<div id="auth-screen" style="position:fixed; inset:0; background:var(--bg); z-index:1000; display:flex; align-items:center; justify-content:center;">
    <div class="glass-card" style="width:350px; text-align:center;">
        <h2 style="font-family:'Orbitron'; color:var(--accent);">SMAL EMPIRE</h2>
        <div id="auth-box">
            <input type="text" id="auth-u" placeholder="Usuario">
            <input type="password" id="auth-p" placeholder="Contrase√±a">
            <button class="btn btn-accent" style="width:100%; margin-top:10px;" onclick="handleAuth()">ENTRAR / REGISTRAR</button>
        </div>
    </div>
</div>

<aside class="sidebar" id="sidebar" style="display:none;">
    <div class="profile">
        <div id="u-ava">?</div>
        <h3 id="u-name">-</h3>
        <div style="color:var(--gold); font-size:1.3rem; font-weight:800;">ü™ô <span id="u-bal">0</span></div>
    </div>
    <nav>
        <div class="nav-item active" onclick="nav('home')">üè† Lobby</div>
        <div class="nav-item" onclick="nav('games')">üé∞ Juegos</div>
        <div class="nav-item" onclick="nav('boxes')">üì¶ Cajas</div>
        <div class="nav-item" onclick="nav('shop')">üõí Tienda</div>
        <div class="nav-item" onclick="nav('inv')">üéí Inventario</div>
        <div class="nav-item" id="adm-nav" style="display:none; color:var(--accent);" onclick="nav('admin')">üõ† PANEL MAESTRO</div>
        <div class="nav-item" style="margin-top:auto; color:var(--red);" onclick="location.reload()">üö™ Salir</div>
    </nav>
</aside>

<main class="main" id="main-content" style="display:none;">
    <section id="v-home" class="view active">
        <h1 style="font-family:'Orbitron';">EL <span style="color:var(--accent);">IMPERIO</span> TE ESPERA</h1>
        <div class="glass-card">
            <h3>Estado del Servidor: <span style="color:var(--accent);">ONLINE</span></h3>
            <p>Usa tus tokens para jugar o abrir cajas exclusivas creadas por el Admin.</p>
        </div>
    </section>

    <section id="v-games" class="view">
        <div id="game-selector" class="game-grid">
            <div class="glass-card game-card" onclick="startSlots()">
                <h2>üé∞ SLOTS</h2>
                <p>Combina 3 figuras. Costo: 10 tokens.</p>
            </div>
            <div class="glass-card game-card" onclick="startMines()">
                <h2>üí£ MINAS</h2>
                <p>No toques la bomba. Multiplica tu apuesta.</p>
            </div>
        </div>
        <div id="game-area" style="display:none;">
            <div id="game-render"></div>
            <button class="btn btn-red" onclick="nav('games')">Volver al Men√∫</button>
        </div>
    </section>

    <section id="v-boxes" class="view">
        <h1>CAJAS MISTERIOSAS</h1>
        <div id="boxes-display" class="game-grid"></div>
    </section>

    <section id="v-shop" class="view">
        <h1>TIENDA DE TOKENS</h1>
        <div id="shop-display" class="game-grid"></div>
        <div class="glass-card" style="margin-top:20px; text-align:center;">
            <p>Para recargas manuales contacta al due√±o:</p>
            <a href="https://wa.me/593987749885" target="_blank" class="btn btn-accent" style="text-decoration:none; display:inline-block;">WHATSAPP DUE√ëO</a>
        </div>
    </section>

    <section id="v-inv" class="view">
        <h1>MI INVENTARIO</h1>
        <div id="inv-display" class="game-grid"></div>
    </section>

    <section id="v-admin" class="view">
        <h1 style="color:var(--accent);">üõ† PANEL MAESTRO</h1>
        
        <div class="glass-card">
            <h3>üì¶ Crear Nueva Caja</h3>
            <input type="text" id="adm-box-name" placeholder="Nombre de la caja (ej: Caja Diamante)">
            <input type="number" id="adm-box-price" placeholder="Precio en tokens">
            <input type="text" id="adm-box-items" placeholder="Premios separados por coma (ej: M4A1, 500 tokens, VIP)">
            <button class="btn btn-accent" onclick="admCreateBox()">PUBLICAR CAJA</button>
        </div>

        <div class="glass-card">
            <h3>üõí Crear Paquete de Tienda</h3>
            <input type="text" id="adm-pack-name" placeholder="Nombre del pack (ej: Starter Pack)">
            <input type="number" id="adm-pack-tokens" placeholder="Tokens que recibe">
            <input type="text" id="adm-pack-price" placeholder="Precio real (ej: $5.00)">
            <button class="btn btn-gold" onclick="admCreatePack()">A√ëADIR A LA TIENDA</button>
        </div>

        <div class="glass-card">
            <h3>üë§ Gesti√≥n de Usuarios</h3>
            <div id="adm-user-list"></div>
        </div>
    </section>
</main>

<script>
// --- CONFIGURACI√ìN Y DATOS ---
let db = JSON.parse(localStorage.getItem('smal_empire_db')) || {
    users: [{u: 'maestro', p: 'EliteV7', bal: 99999, inv: [], admin: true}],
    boxes: [{name: 'Caja Inicial', price: 50, items: ['Token de Bronce', 'Skin B√°sica', '10 Tokens']}],
    shop: [{name: 'Smal Pack', tokens: 100, price: '$1.00'}]
};

let currentUser = null;

function save() { 
    localStorage.setItem('smal_empire_db', JSON.stringify(db)); 
    updateUI();
}

// --- AUTENTICACI√ìN ---
function handleAuth() {
    const u = document.getElementById('auth-u').value.trim();
    const p = document.getElementById('auth-p').value;
    if(!u || !p) return alert("Completa los datos");

    let user = db.users.find(x => x.u === u);
    if(user) {
        if(user.p === p) login(user);
        else alert("Contrase√±a incorrecta");
    } else {
        let newUser = {u: u, p: p, bal: 100, inv: [], admin: false};
        db.users.push(newUser);
        save();
        login(newUser);
    }
}

function login(user) {
    currentUser = user;
    document.getElementById('auth-screen').style.display = 'none';
    document.getElementById('sidebar').style.display = 'flex';
    document.getElementById('main-content').style.display = 'block';
    if(user.admin) document.getElementById('adm-nav').style.display = 'flex';
    nav('home');
    updateUI();
}

// --- NAVEGACI√ìN ---
function nav(id) {
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
    document.getElementById('v-' + id).classList.add('active');
    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
    
    if(id === 'boxes') renderBoxes();
    if(id === 'shop') renderShop();
    if(id === 'inv') renderInv();
    if(id === 'admin') renderAdminUsers();
    
    document.getElementById('game-selector').style.display = 'grid';
    document.getElementById('game-area').style.display = 'none';
}

function updateUI() {
    if(!currentUser) return;
    document.getElementById('u-name').innerText = currentUser.u;
    document.getElementById('u-bal').innerText = currentUser.bal;
    document.getElementById('u-ava').innerText = currentUser.u[0].toUpperCase();
}

// --- JUEGOS FUNCIONALES ---

// 1. SLOTS
function startSlots() {
    document.getElementById('game-selector').style.display = 'none';
    const area = document.getElementById('game-area');
    area.style.display = 'block';
    document.getElementById('game-render').innerHTML = `
        <h2>üé∞ SUPER SLOTS</h2>
        <div class="slot-reels">
            <div class="reel" id="r1">?</div>
            <div class="reel" id="r2">?</div>
            <div class="reel" id="r3">?</div>
        </div>
        <button class="btn btn-accent" onclick="spinSlots()">GIRAR (10 TOKENS)</button>
    `;
}

function spinSlots() {
    if(currentUser.bal < 10) return alert("Tokens insuficientes");
    currentUser.bal -= 10;
    const icons = ['üçí', 'üçã', 'üíé', '7Ô∏è‚É£', '‚≠ê'];
    const res = [icons[Math.floor(Math.random()*5)], icons[Math.floor(Math.random()*5)], icons[Math.floor(Math.random()*5)]];
    
    document.getElementById('r1').innerText = res[0];
    document.getElementById('r2').innerText = res[1];
    document.getElementById('r3').innerText = res[2];

    if(res[0] === res[1] && res[1] === res[2]) {
        alert("¬°JACKPOT! Ganaste 100 tokens");
        currentUser.bal += 100;
        confetti();
    } else if(res[0] === res[1] || res[1] === res[2]) {
        alert("¬°Doble! Ganaste 20 tokens");
        currentUser.bal += 20;
    }
    save();
}

// 2. MINAS
let minePos = 0;
function startMines() {
    document.getElementById('game-selector').style.display = 'none';
    document.getElementById('game-area').style.display = 'block';
    minePos = Math.floor(Math.random()*25);
    let boardHTML = '<div class="mines-board">';
    for(let i=0; i<25; i++) {
        boardHTML += `<div class="tile" id="tile-${i}" onclick="checkMine(${i})">?</div>`;
    }
    boardHTML += '</div><p>Apuesta: 20 tokens. Encuentra cuadros vac√≠os.</p>';
    document.getElementById('game-render').innerHTML = boardHTML;
}

function checkMine(i) {
    if(currentUser.bal < 20) return alert("Tokens insuficientes");
    const t = document.getElementById('tile-' + i);
    if(i === minePos) {
        t.innerText = 'üí£';
        t.className = 'tile bomb';
        currentUser.bal -= 20;
        alert("¬°BOOM! Perdiste");
        startMines();
    } else {
        t.innerText = 'üíé';
        t.className = 'tile safe';
        currentUser.bal += 5;
        confetti({particleCount: 20, spread: 30});
    }
    save();
}

// --- RENDERIZADO DE CONTENIDO ---

function renderBoxes() {
    const div = document.getElementById('boxes-display');
    div.innerHTML = '';
    db.boxes.forEach((box, i) => {
        div.innerHTML += `
            <div class="glass-card text-center">
                <h3>${box.name}</h3>
                <p>Precio: ${box.price} Tokens</p>
                <button class="btn btn-accent" onclick="openBox(${i})">ABRIR</button>
            </div>
        `;
    });
}

function openBox(i) {
    const box = db.boxes[i];
    if(currentUser.bal < box.price) return alert("Tokens insuficientes");
    currentUser.bal -= box.price;
    const win = box.items[Math.floor(Math.random()*box.items.length)];
    currentUser.inv.push(win);
    save();
    alert("¬°Felicidades! Ganaste: " + win);
    confetti();
}

function renderShop() {
    const div = document.getElementById('shop-display');
    div.innerHTML = '';
    db.shop.forEach(p => {
        div.innerHTML += `
            <div class="glass-card text-center">
                <h2>ü™ô ${p.tokens}</h2>
                <p>${p.name}</p>
                <button class="btn btn-gold" onclick="window.open('https://wa.me/593987749885?text=Deseo comprar el paquete ${p.name}')">COMPRAR POR ${p.price}</button>
            </div>
        `;
    });
}

function renderInv() {
    const div = document.getElementById('inv-display');
    div.innerHTML = currentUser.inv.length ? '' : '<p>Mochila vac√≠a...</p>';
    currentUser.inv.forEach(it => {
        div.innerHTML += `<div class="glass-card">üéÅ ${it}</div>`;
    });
}

// --- FUNCIONES ADMIN ---

function admCreateBox() {
    const n = document.getElementById('adm-box-name').value;
    const p = parseInt(document.getElementById('adm-box-price').value);
    const i = document.getElementById('adm-box-items').value.split(',');
    if(!n || !p || i.length < 1) return alert("Faltan datos");
    db.boxes.push({name: n, price: p, items: i});
    save();
    alert("Caja creada con √©xito");
}

function admCreatePack() {
    const n = document.getElementById('adm-pack-name').value;
    const t = parseInt(document.getElementById('adm-pack-tokens').value);
    const p = document.getElementById('adm-pack-price').value;
    if(!n || !t || !p) return alert("Faltan datos");
    db.shop.push({name: n, tokens: t, price: p});
    save();
    alert("Paquete de tienda a√±adido");
}

function renderAdminUsers() {
    const div = document.getElementById('adm-user-list');
    div.innerHTML = '';
    db.users.forEach(u => {
        div.innerHTML += `
            <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #333;">
                <span>${u.u} (${u.bal} tokens)</span>
                <button onclick="admAddTokens('${u.u}')" style="font-size:10px;">+100</button>
            </div>
        `;
    });
}

function admAddTokens(username) {
    let u = db.users.find(x => x.u === username);
    u.bal += 100;
    save();
}

// Iniciar
updateUI();
</script>
</body>
</html>
