<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMAL EMPIRE | CASINO & CMS ELITE</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg: #050a0f; --card: #0f1720; --accent: #00e701; --gold: #f5d033;
            --text: #ffffff; --text-dim: #94a3b8; --border: #1e293b; --danger: #ff4757;
        }
        * { box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; transition: 0.2s; }
        body { background: var(--bg); color: var(--text); margin: 0; overflow: hidden; display: flex; height: 100vh; }

        /* --- SIDEBAR --- */
        .sidebar { width: 280px; background: var(--card); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 100; }
        .nav-item { padding: 16px 25px; cursor: pointer; color: var(--text-dim); display: flex; align-items: center; gap: 12px; font-weight: 600; border-left: 4px solid transparent; }
        .nav-item:hover, .nav-item.active { background: #16212c; color: var(--accent); border-left-color: var(--accent); }

        /* --- MAIN --- */
        .main { flex: 1; overflow-y: auto; padding: 30px; position: relative; background-image: radial-gradient(circle at top right, #1a2c38, #050a0f); }
        .view { display: none; animation: fadeIn 0.4s ease; max-width: 1200px; margin: 0 auto; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- AUTH SYSTEM --- */
        #auth-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 5000; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(15px); }
        .auth-card { background: var(--card); padding: 40px; border-radius: 24px; width: 400px; border: 1px solid var(--accent); text-align: center; box-shadow: 0 0 50px rgba(0, 231, 1, 0.1); }
        input { width: 100%; padding: 14px; margin-bottom: 12px; border-radius: 10px; background: #000; color: #fff; border: 1px solid var(--border); outline: none; }
        .btn { padding: 14px 20px; border: none; border-radius: 10px; font-weight: 800; cursor: pointer; width: 100%; text-transform: uppercase; letter-spacing: 1px; }
        .btn-accent { background: var(--accent); color: black; }
        .btn-gold { background: var(--gold); color: black; }

        /* --- GAME DESIGNS --- */
        .game-screen { background: #070d14; border: 2px solid var(--accent); border-radius: 25px; padding: 30px; margin-top: 20px; min-height: 400px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .grid-5x5 { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; width: 300px; }
        .slot-machine { display: flex; gap: 10px; font-size: 4rem; margin: 20px; background: #000; padding: 20px; border-radius: 15px; border: 2px solid var(--gold); }
        .tile { width: 55px; height: 55px; background: #1e293b; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .tile.win { background: var(--accent); color: black; }
        .tile.lose { background: var(--danger); }
        
        .crash-value { font-size: 5rem; font-family: 'Orbitron'; color: var(--accent); text-shadow: 0 0 20px var(--accent); }

        /* --- SHOP & INV --- */
        .item-card { background: #16212c; border: 1px solid var(--border); border-radius: 20px; padding: 20px; text-align: center; position: relative; }
        .badge { position: absolute; top: 10px; right: 10px; background: var(--danger); padding: 5px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: 800; }
    </style>
</head>
<body>

<div id="auth-overlay">
    <div class="auth-card" id="auth-box">
        <h1 style="font-family:'Orbitron'; color:var(--accent); letter-spacing: 5px; margin-bottom: 5px;">SMAL</h1>
        <p style="color:var(--text-dim); margin-bottom: 30px;">EL IMPERIO DE LOS REYES</p>
        
        <div id="auth-form">
            <input type="text" id="log-user" placeholder="Nombre de usuario">
            <input type="password" id="log-pass" placeholder="Contrase√±a">
            <button class="btn btn-accent" onclick="processAuth('login')">INICIAR SESI√ìN</button>
            <p style="font-size: 0.8rem; margin: 15px 0;">¬øNo tienes cuenta?</p>
            <button class="btn btn-gold" onclick="toggleAuth('reg')">REGISTRARSE</button>
        </div>
    </div>
</div>

<aside class="sidebar">
    <div style="padding: 35px 25px; text-align: center; border-bottom: 1px solid var(--border);">
        <div id="p-avatar" style="width:70px; height:70px; background:var(--accent); color:black; border-radius:22px; display:flex; align-items:center; justify-content:center; margin: 0 auto 15px; font-weight:900; font-size:2rem; box-shadow: 0 10px 30px rgba(0,231,1,0.2);">?</div>
        <h3 id="p-username" style="margin:0; letter-spacing:1px;">JUGADOR</h3>
        <div style="color:var(--gold); font-weight:800; font-size:1.3rem; margin-top:8px;">ü™ô <span id="p-balance">0.00</span></div>
        <div id="p-free" style="font-size:0.75rem; color:var(--danger); margin-top:5px; font-weight:800; letter-spacing:1px;">TIRADAS LIBRES: 3</div>
    </div>
    <nav id="side-menu">
        <div class="nav-item active" onclick="nav('home')">üè† INICIO</div>
        <div class="nav-item" onclick="nav('games')">üéÆ SALA DE JUEGOS</div>
        <div class="nav-item" onclick="nav('boxes')">üì¶ MYSTERY BOXES</div>
        <div class="nav-item" onclick="nav('shop')">üõí TIENDA</div>
        <div class="nav-item" onclick="nav('inv')">üéí MOCHILA</div>
        <div class="nav-item" id="admin-link" style="display:none; color:var(--gold)" onclick="nav('admin')">üõ† PANEL MAESTRO</div>
    </nav>
</aside>

<main class="main">
    <div id="v-home" class="view active">
        <h1 style="font-family:'Orbitron'; font-size: 2.5rem;">BIENVENIDO AL <span style="color:var(--accent)">IMPERIO</span></h1>
        <div style="background: rgba(255,255,255,0.03); padding: 30px; border-radius: 25px; border: 1px solid var(--border);">
            <h3>üìú REGLAS DEL ESTABLECIMIENTO</h3>
            <p>‚Ä¢ 1 USD = 10 Tokens. | Soporte WhatsApp: +593987749885</p>
            <p>‚Ä¢ Tienes 3 tiradas de prueba por cuenta/IP.</p>
            <p>‚Ä¢ Al reclamar un premio, se elimina de tu mochila tras enviarte el ticket.</p>
        </div>
        <div id="custom-sections" class="grid" style="margin-top:20px;"></div>
    </div>

    <div id="v-games" class="view">
        <h1 style="font-family:'Orbitron';">SALA DE APUESTAS</h1>
        <div class="grid" id="game-selection">
            <div class="item-card" onclick="startG('MINAS')">üí£ MINAS</div>
            <div class="item-card" onclick="startG('CRASH')">üöÄ CRASH</div>
            <div class="item-card" onclick="startG('SLOTS')">üé∞ SLOTS</div>
            <div class="item-card" onclick="startG('DICE')">üé≤ DADOS</div>
            <div class="item-card" onclick="startG('COIN')">ü™ô MONEDA</div>
            <div class="item-card" onclick="startG('RULETA')">üé° RULETA</div>
            <div class="item-card" onclick="startG('TOWER')">üóº TORRE</div>
            <div class="item-card" onclick="startG('WHEEL')">üé° RUEDA</div>
            <div class="item-card" onclick="startG('PLINKO')">üîµ PLINKO</div>
            <div class="item-card" onclick="startG('BJ')">üÉè BLACKJACK</div>
        </div>
        
        <div id="game-container" class="game-screen" style="display:none">
            <h2 id="g-name" style="color:var(--gold); font-family:'Orbitron';">JUEGO</h2>
            <div id="g-board" style="margin: 20px 0;"></div>
            <div id="g-controls">
                <button class="btn btn-accent" id="g-action-btn">APOSTAR</button>
                <button class="btn btn-gold" style="margin-top:10px;" onclick="exitGame()">SALIR</button>
            </div>
        </div>
    </div>

    <div id="v-shop" class="view">
        <h1>Tienda de Canje</h1>
        <div class="grid" id="shop-list"></div>
    </div>

    <div id="v-inv" class="view">
        <h1>Mi Mochila (Items para reclamar)</h1>
        <div class="grid" id="inv-list"></div>
    </div>

    <div id="v-admin" class="view">
        <h1 style="color:var(--gold)">CONTROLES MAESTROS</h1>
        <div class="grid">
            <div class="item-card">
                <h3>Crear Men√∫ Manual</h3>
                <input type="text" id="adm-m-n" placeholder="Nombre Men√∫">
                <textarea id="adm-m-c" placeholder="HTML Contenido" rows="4" style="width:100%; background:#000; color:#fff; border:1px solid var(--border); border-radius:10px; padding:10px;"></textarea>
                <button class="btn btn-accent" onclick="adminAddMenu()">PUBLICAR SECCI√ìN</button>
            </div>
            <div class="item-card">
                <h3>A√±adir Item Tienda</h3>
                <input type="text" id="adm-i-n" placeholder="Nombre Producto">
                <input type="number" id="adm-i-p" placeholder="Precio Tokens">
                <button class="btn btn-gold" onclick="adminAddShop()">SUBIR A TIENDA</button>
            </div>
        </div>
    </div>
</main>

<script>
    // --- DATABASE LOCAL SIMULADA ---
    let db = JSON.parse(localStorage.getItem('smal_empire_db')) || {
        users: {}, 
        currentUser: null,
        shop: [{n:"Skin Fuego", p:100}, {n:"Mando PS5", p:2000}],
        menus: []
    };

    function save() { localStorage.setItem('smal_empire_db', JSON.stringify(db)); }

    // --- SISTEMA DE AUTENTICACI√ìN ---
    function toggleAuth(type) {
        const box = document.getElementById('auth-form');
        if(type === 'reg') {
            box.innerHTML = `
                <input type="text" id="reg-user" placeholder="Nuevo Usuario">
                <input type="password" id="reg-pass" placeholder="Nueva Contrase√±a">
                <button class="btn btn-gold" onclick="processAuth('reg')">CREAR CUENTA</button>
                <button class="btn" style="color:white" onclick="location.reload()">VOLVER</button>
            `;
        }
    }

    function processAuth(type) {
        if(type === 'reg') {
            let u = document.getElementById('reg-user').value;
            let p = document.getElementById('reg-pass').value;
            if(u.length < 3) return alert("Usuario muy corto");
            db.users[u] = { pass: p, bal: 0, free: 3, inv: [] };
            alert("Cuenta creada! Ahora inicia sesi√≥n.");
            location.reload();
        } else {
            let u = document.getElementById('log-user').value;
            let p = document.getElementById('log-pass').value;
            if(db.users[u] && db.users[u].pass === p) {
                db.currentUser = u;
                document.getElementById('auth-overlay').style.display = 'none';
                if(u === "SmalAdmin") document.getElementById('admin-link').style.display = 'flex';
                initSession();
            } else { alert("Datos incorrectos"); }
        }
        save();
    }

    function initSession() {
        let u = db.users[db.currentUser];
        document.getElementById('p-username').innerText = db.currentUser;
        document.getElementById('p-avatar').innerText = db.currentUser[0].toUpperCase();
        updateUI();
        renderMenus();
    }

    function updateUI() {
        let u = db.users[db.currentUser];
        document.getElementById('p-balance').innerText = u.bal.toFixed(2);
        document.getElementById('p-free').innerText = "TIRADAS LIBRES: " + u.free;
        save();
    }

    function nav(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById('v-' + id).classList.add('active');
        if(id === 'shop') renderShop();
        if(id === 'inv') renderInv();
    }

    // --- L√ìGICA DE JUEGOS DIN√ÅMICOS ---
    let currentGame = "";
    function startG(game) {
        currentGame = game;
        document.getElementById('game-selection').style.display = 'none';
        const container = document.getElementById('game-container');
        container.style.display = 'flex';
        document.getElementById('g-name').innerText = game;
        setupBoard(game);
    }

    function setupBoard(game) {
        const board = document.getElementById('g-board');
        const btn = document.getElementById('g-action-btn');
        board.innerHTML = "";
        
        if(game === 'MINAS') {
            board.innerHTML = `<div class="grid-5x5">${Array(25).fill('<div class="tile" onclick="playMinas(this)">?</div>').join('')}</div>`;
            btn.style.display = 'none';
        } else if(game === 'CRASH') {
            board.innerHTML = `<div class="crash-value" id="crash-v">1.00x</div>`;
            btn.innerText = "DESPEGAR";
            btn.onclick = playCrash;
        } else if(game === 'SLOTS') {
            board.innerHTML = `<div class="slot-machine" id="slots-res">üé∞üé∞üé∞</div>`;
            btn.innerText = "GIRAR";
            btn.onclick = playSlots;
        } else {
            board.innerHTML = `<p>Apostar 10 tokens en ${game}</p>`;
            btn.onclick = playGeneric;
        }
    }

    function checkCost() {
        let u = db.users[db.currentUser];
        if(u.free > 0) { u.free--; updateUI(); return true; }
        if(u.bal >= 10) { u.bal -= 10; updateUI(); return true; }
        alert("Sin tokens ni tiradas gratis. Recarga con PayPal.");
        return false;
    }

    // --- MINAS ---
    function playMinas(el) {
        if(el.innerText !== "?") return;
        if(!checkCost()) return;
        let win = Math.random() > 0.3;
        if(win) {
            el.innerText = "üíé"; el.classList.add('win');
            db.users[db.currentUser].bal += 20;
            confetti();
        } else {
            el.innerText = "üí£"; el.classList.add('lose');
            alert("¬°BOOM! Perdiste.");
        }
        updateUI();
    }

    // --- CRASH ---
    function playCrash() {
        if(!checkCost()) return;
        let val = 1.0;
        let crashAt = (Math.random() * 5) + 1.1;
        const btn = document.getElementById('g-action-btn');
        btn.innerText = "COBRAR";
        let timer = setInterval(() => {
            val += 0.05;
            document.getElementById('crash-v').innerText = val.toFixed(2) + "x";
            if(val >= crashAt) {
                clearInterval(timer);
                document.getElementById('crash-v').style.color = "red";
                btn.innerText = "CRASHED";
                setTimeout(() => setupBoard('CRASH'), 2000);
            }
        }, 100);
        btn.onclick = () => {
            clearInterval(timer);
            db.users[db.currentUser].bal += (10 * val);
            alert("Ganaste: " + (10 * val).toFixed(2));
            updateUI();
            setupBoard('CRASH');
        };
    }

    // --- SLOTS ---
    function playSlots() {
        if(!checkCost()) return;
        const emojis = ["üçé", "üçã", "üíé", "üîî", "7Ô∏è‚É£"];
        let r1 = emojis[Math.floor(Math.random()*5)];
        let r2 = emojis[Math.floor(Math.random()*5)];
        let r3 = emojis[Math.floor(Math.random()*5)];
        document.getElementById('slots-res').innerText = `${r1}${r2}${r3}`;
        if(r1 === r2 && r2 === r3) {
            db.users[db.currentUser].bal += 100;
            confetti(); alert("¬°JACKPOT! +100 Tokens");
        }
        updateUI();
    }

    function exitGame() {
        document.getElementById('game-selection').style.display = 'grid';
        document.getElementById('game-container').style.display = 'none';
    }

    // --- TIENDA E INVENTARIO ---
    function renderShop() {
        const c = document.getElementById('shop-list');
        c.innerHTML = "";
        db.shop.forEach(i => {
            c.innerHTML += `<div class="item-card"><h3>${i.n}</h3><p>${i.p} TKN</p><button class="btn btn-accent" onclick="buy('${i.n}', ${i.p})">COMPRAR</button></div>`;
        });
    }

    function buy(n, p) {
        let u = db.users[db.currentUser];
        if(u.bal < p) return alert("Faltan tokens");
        u.bal -= p; u.inv.push(n); updateUI(); alert("¬°Comprado!");
    }

    function renderInv() {
        const c = document.getElementById('inv-list');
        c.innerHTML = "";
        db.users[db.currentUser].inv.forEach((item, idx) => {
            c.innerHTML += `<div class="item-card"><h3>${item}</h3><button class="btn btn-gold" onclick="claim('${item}', ${idx})">RECLAMAR WHATSAPP</button></div>`;
        });
    }

    function claim(item, idx) {
        window.open(`https://wa.me/593987749885?text=Hola SmalAdmin, soy ${db.currentUser} y reclamo mi premio: ${item}`);
        db.users[db.currentUser].inv.splice(idx, 1);
        save(); renderInv();
        alert("Item reclamado y eliminado de mochila.");
    }

    // --- ADMIN ---
    function adminAddMenu() {
        let n = document.getElementById('adm-m-n').value;
        let c = document.getElementById('adm-m-c').value;
        db.menus.push({n, c});
        save(); alert("Men√∫ creado"); renderMenus();
    }

    function renderMenus() {
        const area = document.getElementById('custom-sections');
        area.innerHTML = "";
        db.menus.forEach(m => {
            area.innerHTML += `<div class="item-card" onclick="alert('Cargando...')"><h3>${m.n}</h3></div>`;
        });
    }

</script>
</body>
</html>
