<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Smal Casino | Elite System</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0b0e11; --side: #15191c; --card: #21262b; --accent: #00e701; --gold: #f5d547; --lose: #ff3366; --text: #b1bad3; }
        * { box-sizing: border-box; font-family: 'Rajdhani', sans-serif; transition: 0.2s; }
        body { background: var(--bg); color: var(--text); margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* SIDEBAR */
        .sidebar { width: 280px; background: var(--side); border-right: 1px solid #2f373d; display: flex; flex-direction: column; }
        .nav-item { padding: 15px 25px; cursor: pointer; font-weight: bold; display: flex; align-items: center; gap: 12px; border-left: 4px solid transparent; }
        .nav-item:hover, .nav-item.active { background: var(--card); color: white; border-left-color: var(--accent); }

        /* HEADER */
        .main { flex: 1; display: flex; flex-direction: column; overflow-y: auto; background: radial-gradient(circle at top, #1a2c38 0%, #0b0e11 100%); }
        .header { height: 70px; padding: 0 30px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #2f373d; background: rgba(0,0,0,0.3); }
        .balance-pill { background: #1a2127; padding: 8px 15px; border-radius: 5px; border: 1px solid var(--accent); color: white; display: flex; gap: 10px; align-items: center; }

        /* VISTAS */
        .view { padding: 40px; display: none; animation: fadeIn 0.3s; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* MINAS JUEGO */
        .game-container { display: flex; background: var(--side); border-radius: 15px; max-width: 950px; margin: auto; height: 550px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .controls { width: 300px; padding: 30px; border-right: 1px solid #2f373d; background: #1a2127; }
        .grid-space { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #071620; }
        .mines-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        .cell { width: 70px; height: 70px; background: var(--card); border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 2rem; border-bottom: 4px solid #101e26; }
        .cell.revealed { cursor: default; background: #2f373d; }

        /* BOTONES */
        .btn-play { background: var(--accent); color: black; border: none; padding: 15px; border-radius: 5px; font-weight: bold; cursor: pointer; width: 100%; font-family: 'Orbitron'; }
        .btn-cash { background: var(--gold); color: black; border: none; padding: 15px; border-radius: 5px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; display: none; }
        input, select { background: #0b0e11; border: 1px solid #2f373d; color: white; padding: 12px; width: 100%; border-radius: 5px; margin-bottom: 15px; }

        /* LOGIN OVERLAY */
        #auth-screen { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .auth-card { background: var(--side); padding: 40px; border-radius: 20px; border: 1px solid var(--accent); width: 380px; text-align: center; }

        /* FREE SPINS TAG */
        .free-tag { background: var(--lose); color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; }
    </style>
</head>
<body>

<div id="auth-screen">
    <div class="auth-card">
        <h1 style="font-family:'Orbitron'; color:white; letter-spacing: 5px;">SMAL</h1>
        <p>Reg칤strate y recibe <b>3 TIROS GRATIS</b></p>
        <input type="text" id="auth-user" placeholder="Nombre de usuario">
        <input type="password" id="auth-pass" placeholder="Contrase침a">
        <button class="btn-play" onclick="handleLogin()">ENTRAR AL IMPERIO</button>
    </div>
</div>

<aside class="sidebar">
    <div style="padding:30px; text-align:center; border-bottom:1px solid #2f373d;">
        <div id="p-avatar" style="width:60px; height:60px; background:var(--accent); border-radius:50%; margin:0 auto 10px; display:flex; align-items:center; justify-content:center; color:black; font-weight:bold; font-size:1.5rem;">?</div>
        <div id="p-name" style="color:white; font-weight:bold;">Usuario</div>
        <div id="p-rank" style="color:var(--gold); font-size:0.8rem; font-weight:bold;">RANGO: NOVATO</div>
    </div>
    <div class="nav-group">
        <div class="nav-item active" onclick="tab('lobby')">游 Inicio / Tiros <span class="free-tag" id="p-spins">0</span></div>
        <div class="nav-item" onclick="tab('mines')">游눢 Minas Pro</div>
        <div class="nav-item" onclick="tab('inv')">游 Mi Inventario</div>
        <div class="nav-item" onclick="tab('admin')" style="color:var(--gold); margin-top:20px;">游 Panel Due침o</div>
    </div>
</aside>

<main class="main">
    <div class="header">
        <div id="header-title" style="font-weight:bold; color:white; font-family:'Orbitron';">LOBBY</div>
        <div class="balance-pill">游뿣 <span id="p-bal">0.00</span></div>
    </div>

    <div id="v-lobby" class="view active">
        <h1>Bienvenido al Casino Smal</h1>
        <p>Tu monedero y progreso se guardan autom치ticamente. No pierdas tu contrase침a.</p>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
            <div style="background:var(--card); padding:20px; border-radius:10px;">
                <h3>Bonos Activos</h3>
                <p id="bonus-info">Tienes 3 Tiros Gratis para usar en Minas.</p>
            </div>
            <div style="background:var(--card); padding:20px; border-radius:10px; border:1px solid var(--gold);">
                <h3>Recargar Tokens</h3>
                <p>M칤nimo $80 para nivel VIP.</p>
                <button class="btn-play" style="background:var(--gold)" onclick="window.open('https://wa.me/593987749885')">WHATSAPP</button>
            </div>
        </div>
    </div>

    <div id="v-mines" class="view">
        <div class="game-container">
            <div class="controls">
                <label>Monto de Apuesta</label>
                <input type="number" id="m-bet" value="5">
                <label>N칰mero de Minas</label>
                <select id="m-count">
                    <option value="3">3 Minas (F치cil)</option>
                    <option value="10">10 Minas (Dif칤cil)</option>
                    <option value="20">20 Minas (Extremo)</option>
                </select>
                <button class="btn-play" id="m-start" onclick="startMines()">APOSTAR</button>
                <button class="btn-cash" id="m-cash" onclick="cashout()">RETIRAR GANANCIA</button>
                <div style="margin-top:30px; text-align:center;">
                    <div id="m-mult" style="font-size:3rem; color:var(--accent); font-family:'Orbitron';">1.00x</div>
                    <div id="m-profit">Ganancia: 0.00</div>
                </div>
            </div>
            <div class="grid-space">
                <div class="mines-grid" id="m-grid"></div>
            </div>
        </div>
    </div>

    <div id="v-inv" class="view">
        <h2>游 Inventario de Premios Reales</h2>
        <div id="inv-list" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(200px,1fr)); gap:20px;"></div>
    </div>

    <div id="v-admin" class="view">
        <h1 style="color:var(--gold)">PANEL MAESTRO</h1>
        <div style="background:var(--card); padding:25px; border-radius:10px;">
            <h3>游 Configurar Probabilidades</h3>
            <p>A침ade items que los usuarios ganar치n si llegan a 2x en las Minas.</p>
            <input type="text" id="adm-item" placeholder="Nombre del Premio (Ej: Tarjeta $10)">
            <input type="number" id="adm-prob" placeholder="Probabilidad (1-100)%">
            <button class="btn-play" onclick="addItem()">GUARDAR ITEM EN EL SISTEMA</button>
        </div>
        <button onclick="data.balance+=500; update();" style="margin-top:20px;" class="btn-play">Darse 500 Tokens</button>
    </div>
</main>

<script>
    // --- SEGURIDAD Y DATOS ---
    let data = {
        user: "", balance: 20.0, spins: 3, inv: [], xp: 0,
        pool: [{n: "Rango VIP", p: 5}, {n: "Bono $5", p: 15}]
    };

    let isPlaying = false;
    let mines = [];
    let mult = 1.0;
    let currentBet = 0;

    function save() { localStorage.setItem('smal_vault_' + data.user, JSON.stringify(data)); }

    function handleLogin() {
        let u = document.getElementById('auth-user').value;
        if(!u) return alert("Ingresa usuario");
        
        let saved = localStorage.getItem('smal_vault_' + u);
        if(saved) data = JSON.parse(saved);
        else data.user = u;
        
        document.getElementById('auth-screen').style.display = 'none';
        update();
    }

    function update() {
        document.getElementById('p-bal').innerText = data.balance.toFixed(2);
        document.getElementById('p-name').innerText = data.user;
        document.getElementById('p-spins').innerText = data.spins;
        document.getElementById('p-avatar').innerText = data.user[0].toUpperCase();
        
        // Rango por experiencia
        if(data.xp > 500) document.getElementById('p-rank').innerText = "RANGO: ELITE";
        if(data.xp > 2000) document.getElementById('p-rank').innerText = "RANGO: LEYENDA";

        save();
        renderInv();
    }

    function tab(v) {
        document.querySelectorAll('.view').forEach(x => x.classList.remove('active'));
        document.getElementById('v-' + v).classList.add('active');
        document.getElementById('header-title').innerText = v.toUpperCase();
        if(v === 'mines') buildGrid();
    }

    // --- L칍GICA DE JUEGO SEGURA ---
    function buildGrid() {
        const g = document.getElementById('m-grid'); g.innerHTML = '';
        for(let i=0; i<25; i++) {
            let c = document.createElement('div');
            c.className = 'cell';
            c.onclick = () => reveal(c, i);
            g.appendChild(c);
        }
    }

    function startMines() {
        let betInput = parseFloat(document.getElementById('m-bet').value);
        
        // Sistema de Tiros Gratis
        if(data.spins > 0) {
            if(confirm("쯋sar 1 de tus 3 tiros gratis?")) {
                data.spins--;
                currentBet = betInput; // Apuesta ficticia para el c치lculo
            } else {
                if(data.balance < betInput) return alert("Saldo insuficiente.");
                data.balance -= betInput;
                currentBet = betInput;
            }
        } else {
            if(data.balance < betInput) return alert("Saldo insuficiente.");
            data.balance -= betInput;
            currentBet = betInput;
        }

        isPlaying = true; mult = 1.0; mines = [];
        let mTotal = document.getElementById('m-count').value;
        while(mines.length < mTotal) {
            let r = Math.floor(Math.random()*25);
            if(!mines.includes(r)) mines.push(r);
        }

        document.getElementById('m-start').disabled = true;
        document.getElementById('m-cash').style.display = 'block';
        buildGrid();
        update();
    }

    function reveal(el, i) {
        if(!isPlaying || el.innerHTML !== '') return;
        
        if(mines.includes(i)) {
            el.innerHTML = '游눢'; el.style.background = var(--lose);
            isPlaying = false;
            alert("춰BOOM! Perdiste.");
            resetMines();
        } else {
            el.innerHTML = '游눑'; el.style.background = var(--accent);
            let step = (25 / (25 - mines.length)) * 0.3;
            mult += step;
            document.getElementById('m-mult').innerText = mult.toFixed(2) + "x";
            document.getElementById('m-profit').innerText = "Ganancia: " + (currentBet * mult).toFixed(2);
        }
    }

    function cashout() {
        if(!isPlaying) return;
        let win = currentBet * mult;
        data.balance += win;
        data.xp += 20;

        // Probabilidad de Items (Solo si el mult es > 2x)
        if(mult > 2.0) {
            data.pool.forEach(item => {
                if(Math.random()*100 < item.p) {
                    data.inv.push({n: item.n, d: new Date().toLocaleDateString()});
                    alert("游꾸 춰HAS GANADO UN ITEM REAL!: " + item.n);
                }
            });
        }

        alert("游눯 Retirado: " + win.toFixed(2));
        resetMines();
        update();
    }

    function resetMines() {
        isPlaying = false;
        document.getElementById('m-start').disabled = false;
        document.getElementById('m-cash').style.display = 'none';
        document.getElementById('m-mult').innerText = "1.00x";
    }

    // --- INVENTARIO Y ADMIN ---
    function renderInv() {
        const container = document.getElementById('inv-list');
        container.innerHTML = data.inv.length ? '' : '<p>No tienes premios.</p>';
        data.inv.forEach((it, idx) => {
            container.innerHTML += `
                <div style="background:var(--card); padding:15px; border-radius:10px; border:1px solid var(--accent); text-align:center;">
                    <b>${it.n}</b><br><small>${it.d}</small><br>
                    <button class="btn-play" style="padding:5px; margin-top:10px; font-size:0.7rem;" onclick="claim('${it.n}', ${idx})">RECLAMAR AL DUE칌O</button>
                </div>
            `;
        });
    }

    function claim(name, idx) {
        window.open(`https://wa.me/593987749885?text=Hola Smal, soy ${data.user} y quiero mi premio: ${name}`);
        data.inv.splice(idx, 1);
        update();
    }

    function addItem() {
        let n = document.getElementById('adm-item').value;
        let p = document.getElementById('adm-prob').value;
        if(!n || !p) return;
        data.pool.push({n: n, p: parseInt(p)});
        alert("Item guardado en la base de datos de premios.");
        update();
    }
</script>
</body>
</html>
