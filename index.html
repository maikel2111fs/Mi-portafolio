<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMAL EMPIRE | PRO V11</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Plus+Jakarta+Sans:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root { --bg: #040609; --card: #0d1117; --accent: #00ff59; --gold: #f5d033; --text: #ffffff; --border: #21262d; }
        body { background: var(--bg); color: var(--text); font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar Estilo Pro */
        .sidebar { width: 280px; background: var(--card); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 10; }
        .nav-item { padding: 20px; cursor: pointer; border-left: 4px solid transparent; color: #8b949e; font-weight: bold; }
        .nav-item.active { background: #161b22; color: var(--accent); border-left-color: var(--accent); }

        /* Main Area */
        .main { flex: 1; padding: 40px; overflow-y: auto; background: radial-gradient(circle at top, #0f1a14, var(--bg)); }
        .view { display: none; }
        .view.active { display: block; animation: fadeIn 0.3s ease; }
        
        /* Componentes de Juego */
        .glass { background: rgba(13, 25, 20, 0.6); border: 1px solid var(--border); border-radius: 15px; padding: 25px; margin-bottom: 20px; }
        .btn { background: var(--accent); color: #000; border: none; padding: 15px 30px; border-radius: 8px; font-weight: 800; cursor: pointer; width: 100%; text-transform: uppercase; }
        .btn:disabled { opacity: 0.5; }

        .stat-card { border-left: 4px solid var(--gold); padding-left: 15px; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Estilo para los Planes de 80 USD */
        .plan-card { border: 2px solid var(--gold); text-align: center; padding: 20px; border-radius: 15px; }
    </style>
</head>
<body>

<div id="auth-screen" style="position:fixed; inset:0; background:var(--bg); z-index:100; display:flex; align-items:center; justify-content:center;">
    <div class="glass" style="width:350px; text-align:center;">
        <h1 style="font-family:'Orbitron'; color:var(--accent)">SMAL EMPIRE</h1>
        <input type="text" id="username" placeholder="Usuario" style="width:100%; padding:12px; margin-bottom:10px; background:#000; border:1px solid var(--border); color:#fff;">
        <button class="btn" onclick="app.login()">ENTRAR</button>
    </div>
</div>

<aside class="sidebar">
    <div style="padding:30px; text-align:center;">
        <div id="u-ava" style="width:60px; height:60px; background:var(--accent); color:#000; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 10px; font-weight:900; font-size:1.5rem;">?</div>
        <div id="u-name" style="font-weight:800;">USUARIO</div>
        <div style="color:var(--gold); font-size:1.4rem; font-weight:900; margin-top:10px;">ðŸª™ <span id="u-bal">0</span></div>
    </div>
    <nav>
        <div class="nav-item active" onclick="app.nav('lobby')">LOBBY</div>
        <div class="nav-item" onclick="app.nav('slots')">ðŸŽ° SLOTS</div>
        <div class="nav-item" onclick="app.nav('shop')">ðŸ›’ TIENDA (VIP)</div>
        <div class="nav-item" id="admin-nav" style="display:none; color:var(--accent)" onclick="app.nav('admin')">ðŸ›  PANEL MAESTRO</div>
        <div class="nav-item" style="color:#ff4747; margin-top:auto" onclick="location.reload()">SALIR</div>
    </nav>
</aside>

<main class="main">
    <div id="v-lobby" class="view active">
        <h1>BIENVENIDO AL IMPERIO</h1>
        <div class="glass">
            <h3>Estado del Sistema</h3>
            <p>Contratos API cargados (Zod/Drizzle Logic). Listo para transacciones.</p>
        </div>
    </div>

    <div id="v-slots" class="view">
        <h1>ðŸŽ° SLOTS PRO</h1>
        <div class="glass" style="display:flex; justify-content:center; gap:20px; font-size:4rem; margin-bottom:20px;">
            <div id="r1">ðŸ’Ž</div><div id="r2">ðŸ’Ž</div><div id="r3">ðŸ’Ž</div>
        </div>
        <button class="btn" id="spin-btn" onclick="app.playSlots()">APOSTAR 50 TOKENS</button>
    </div>

    <div id="v-shop" class="view">
        <h1>TIENDA ELITE</h1>
        <div class="plan-card">
            <h2>PAQUETE INVERSIONISTA</h2>
            <p style="font-size:2rem; color:var(--gold);">80.00 USD</p>
            <p>Incluye: 10,000 Tokens + Rango VIP</p>
            <button class="btn" onclick="window.open('https://wa.me/593987749885?text=Hola, quiero el plan de 80 USD')">COMPRAR POR WHATSAPP</button>
        </div>
    </div>

    <div id="v-admin" class="view">
        <h1>PANEL MAESTRO</h1>
        <div class="glass">
            <h3>GestiÃ³n de Perfiles (Drizzle Schema)</h3>
            <input type="text" id="adm-u" placeholder="Usuario" style="width:100%; padding:10px; margin-bottom:10px; background:#000; border:1px solid var(--border); color:#fff;">
            <input type="number" id="adm-a" placeholder="Cantidad de Tokens" style="width:100%; padding:10px; margin-bottom:10px; background:#000; border:1px solid var(--border); color:#fff;">
            <button class="btn" onclick="app.adminAdd()">CARGAR TOKENS</button>
        </div>
    </div>
</main>

<script>
    // Siguiendo tu esquema de API Contract (Profile/Transaction)
    const app = {
        db: JSON.parse(localStorage.getItem('smal_empire_v11')) || {
            profiles: [{userId: 'maestro', balance: 5000, isAdmin: true}],
            transactions: []
        },
        user: null,

        login() {
            const name = document.getElementById('username').value.trim().toLowerCase();
            if(!name) return;
            let profile = this.db.profiles.find(p => p.userId === name);
            if(!profile) {
                profile = { userId: name, balance: 1000, isAdmin: false, createdAt: new Date() };
                this.db.profiles.push(profile);
            }
            this.user = profile;
            document.getElementById('auth-screen').style.display = 'none';
            if(profile.isAdmin) document.getElementById('admin-nav').style.display = 'block';
            this.updateUI();
            this.save();
        },

        nav(viewId) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById('v-' + viewId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        },

        updateUI() {
            document.getElementById('u-name').innerText = this.user.userId.toUpperCase();
            document.getElementById('u-bal').innerText = Number(this.user.balance).toLocaleString();
            document.getElementById('u-ava').innerText = this.user.userId[0].toUpperCase();
        },

        playSlots() {
            if(this.user.balance < 50) return alert("Saldo insuficiente");
            this.user.balance -= 50;
            const reels = ['ðŸ’', 'ðŸ’Ž', 'ðŸ‹', '7ï¸âƒ£', 'ðŸ‡'];
            const res = [reels[Math.floor(Math.random()*5)], reels[Math.floor(Math.random()*5)], reels[Math.floor(Math.random()*5)]];
            
            document.getElementById('r1').innerText = res[0];
            document.getElementById('r2').innerText = res[1];
            document.getElementById('r3').innerText = res[2];

            if(res[0] === res[1] && res[1] === res[2]) {
                const win = 500;
                this.user.balance += win;
                confetti();
                alert("JACKPOT: +" + win);
            }
            this.save();
        },

        adminAdd() {
            const target = document.getElementById('adm-u').value.toLowerCase();
            const amount = parseInt(document.getElementById('adm-a').value);
            const p = this.db.profiles.find(x => x.userId === target);
            if(p) {
                p.balance += amount;
                this.save();
                alert("Tokens cargados");
            }
        },

        save() {
            localStorage.setItem('smal_empire_v11', JSON.stringify(this.db));
            this.updateUI();
        }
    };
</script>
</body>
</html>
