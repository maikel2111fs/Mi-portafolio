<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smal Casino | Master System</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-body: #0f212e; --bg-side: #1a2c38; --bg-card: #213743;
            --accent: #00e701; --text: #b1bad3; --white: #ffffff; 
            --gold: #ffcc00; --lose: #ff3366; --border: #2f4553;
        }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; transition: 0.2s; }
        body { background: var(--bg-body); color: var(--text); margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* --- SISTEMA DE LOGIN DUAL --- */
        #auth-screen { position: fixed; inset: 0; background: var(--bg-body); z-index: 10000; display: flex; align-items: center; justify-content: center; }
        .auth-box { background: var(--bg-side); padding: 40px; border-radius: 8px; width: 400px; border: 1px solid var(--border); text-align: center; }
        .auth-logo { font-family: 'Orbitron'; color: var(--white); font-size: 2.2rem; margin-bottom: 25px; letter-spacing: 5px; }
        
        /* --- SIDEBAR & NAV --- */
        .sidebar { width: 240px; background: var(--bg-side); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .nav-link { padding: 15px 20px; cursor: pointer; display: flex; align-items: center; gap: 12px; font-weight: 600; font-size: 0.9rem; border-right: 3px solid transparent; }
        .nav-link:hover, .nav-link.active { background: var(--bg-card); color: var(--white); border-right-color: var(--accent); }

        .main-content { flex: 1; display: flex; flex-direction: column; position: relative; }
        .navbar { height: 60px; background: var(--bg-side); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 25px; }

        /* --- MONEDERO --- */
        .wallet-pill { background: var(--bg-body); border: 1px solid var(--border); border-radius: 4px; display: flex; align-items: center; }
        .bal-val { padding: 8px 15px; color: var(--white); font-weight: 800; font-size: 0.9rem; }
        .btn-deposit { background: var(--bg-card); color: var(--white); border: none; padding: 8px 15px; cursor: pointer; border-left: 1px solid var(--border); font-weight: bold; }

        /* --- JUEGO MINAS (ESTILO STAKE) --- */
        .game-view { flex: 1; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .stake-box { background: var(--bg-side); width: 100%; max-width: 950px; height: 580px; border-radius: 8px; display: flex; overflow: hidden; border: 1px solid var(--border); }
        .stake-sidebar { width: 300px; padding: 25px; border-right: 2px solid var(--bg-body); background: var(--bg-side); }
        .grid-container { flex: 1; background: var(--bg-body); display: flex; align-items: center; justify-content: center; }
        
        .mines-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; width: 450px; height: 450px; }
        .tile { background: var(--bg-card); border-radius: 4px; cursor: pointer; border-bottom: 4px solid #101e26; display: flex; align-items: center; justify-content: center; font-size: 2.2rem; }
        .tile:hover { background: #2f4553; }
        .tile.revealed { background: var(--bg-body); border-bottom: none; }

        /* --- BOTONES --- */
        .btn-bet { background: var(--accent); color: #000; border: none; padding: 18px; border-radius: 4px; font-weight: 800; cursor: pointer; width: 100%; font-size: 1rem; margin-top: 10px; }
        .btn-bet:disabled { background: #2f4553; color: #557086; cursor: not-allowed; }
        .btn-cash { background: var(--gold); color: #000; border: none; padding: 18px; border-radius: 4px; font-weight: 800; cursor: pointer; width: 100%; display: none; margin-top: 10px; }

        input, select { background: var(--bg-body); border: 2px solid var(--border); color: var(--white); padding: 12px; width: 100%; border-radius: 4px; margin-bottom: 12px; font-weight: bold; outline: none; }
        
        /* --- PANEL ADMIN OCULTO --- */
        #admin-panel { display: none; padding: 40px; background: var(--bg-body); position: absolute; inset: 0; z-index: 50; overflow-y: auto; }
        .admin-card { background: var(--bg-side); padding: 25px; border-radius: 8px; border: 1px dashed var(--gold); margin-bottom: 20px; }

        .terms { font-size: 0.7rem; color: #557086; margin-top: 15px; text-align: left; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>

<div id="auth-screen">
    <div class="auth-box">
        <div class="auth-logo">SMAL</div>
        <p style="font-size: 0.9rem;">Acceso al Imperio Smal</p>
        <input type="text" id="user-in" placeholder="Usuario">
        <input type="password" id="pass-in" placeholder="Contrase√±a o Master Key">
        
        <div class="terms">
            <input type="checkbox" id="terms-check"> Acepto que <b>no hay reembolsos</b>. Entiendo que el saldo es digital y los premios se reclaman v√≠a WhatsApp.
        </div>
        
        <button class="btn-bet" onclick="initSession()">ENTRAR</button>
        <p style="font-size: 0.7rem; margin-top: 15px;">Admin Key: <b>admin123</b> (Cambiar en el c√≥digo)</p>
    </div>
</div>

<aside class="sidebar">
    <div style="padding: 25px; font-family: 'Orbitron'; color: white; font-size: 1.5rem;">STAKE</div>
    <div class="nav-link active" onclick="showView('game')">üé∞ Casino Original</div>
    <div class="nav-link" onclick="showView('inv')">üéí Mi Inventario</div>
    <div class="nav-link" onclick="window.open('https://wa.me/593987749885')">üí¨ Soporte WhatsApp</div>
    <div id="admin-btn" class="nav-link" style="color:var(--gold); display:none; margin-top: auto;" onclick="showView('admin')">üõ† PANEL MAESTRO</div>
</aside>

<main class="main-content">
    <nav class="navbar">
        <div style="font-size: 0.75rem; font-weight: bold;">SMAL CASINO | ELITE PARTNER</div>
        <div class="wallet-pill">
            <div class="bal-val">ü™ô <span id="u-bal">0.00000000</span></div>
            <button class="btn-deposit" onclick="window.open('https://wa.me/593987749885')">Depositar</button>
        </div>
    </nav>

    <div id="v-game" class="view">
        <div class="game-view">
            <div class="stake-box">
                <div class="stake-sidebar">
                    <label style="font-size: 0.7rem; font-weight: bold;">Monto de Apuesta</label>
                    <input type="number" id="m-bet" value="10.00">
                    
                    <label style="font-size: 0.7rem; font-weight: bold;">Minas</label>
                    <select id="m-count">
                        <option value="1">1 Mina</option>
                        <option value="3" selected>3 Minas</option>
                        <option value="10">10 Minas</option>
                        <option value="24">24 Minas</option>
                    </select>

                    <p style="font-size: 0.8rem;">Tiros Gratis: <b id="u-spins" style="color:var(--accent)">0</b></p>

                    <button class="btn-bet" id="btn-play" onclick="startMines()">Apostar</button>
                    <button class="btn-cash" id="btn-cash" onclick="cashout()">Retirar</button>

                    <div style="text-align: center; margin-top: 50px;">
                        <div id="m-mult" style="font-size: 2.5rem; color: white; font-weight: 800;">1.00x</div>
                        <div id="m-profit" style="color: var(--accent); font-weight: bold;">0.00 US$</div>
                    </div>
                </div>
                <div class="grid-container">
                    <div class="mines-grid" id="grid"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="v-inv" class="view" style="display:none; padding: 40px;">
        <h2>üéí Premios y Rangos Ganados</h2>
        <div id="inv-list" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px;"></div>
    </div>

    <div id="v-admin" class="view" style="display:none; padding: 40px;">
        <h1 style="color:var(--gold)">STUDIO DE CONFIGURACI√ìN</h1>
        <div class="admin-card">
            <h3>üéÅ Crear Item de Bot√≠n (Premios Reales)</h3>
            <p>Estos items aparecer√°n en el inventario del usuario si gana con multiplicador > 2x.</p>
            <input type="text" id="adm-name" placeholder="Ej: Rango VIP, Tarjeta $20, Skin Rare">
            <input type="number" id="adm-prob" placeholder="Probabilidad (1-100)%">
            <button class="btn-bet" onclick="addPoolItem()">A√ëADIR AL SISTEMA</button>
        </div>
        <div class="admin-card">
            <h3>üí∞ Control de Econom√≠a</h3>
            <button class="btn-bet" style="background:var(--white)" onclick="stats.balance += 1000; update();">Darse 1000 Tokens</button>
            <button class="btn-bet" style="background:var(--lose); color:white; margin-top:10px;" onclick="localStorage.clear(); location.reload();">RESETEAR TODO EL CASINO</button>
        </div>
    </div>
</main>

<script>
    // --- N√öCLEO Y SEGURIDAD ---
    let stats = {
        user: "", balance: 25.0, spins: 3, inv: [], 
        isAdmin: false,
        pool: [{n: "Rango Bronce", p: 20}, {n: "Bono $10", p: 5}]
    };

    let playing = false;
    let minesArr = [];
    let curMult = 1.0;
    let curBet = 0;

    function save() { 
        localStorage.setItem('smal_master_' + stats.user, JSON.stringify(stats)); 
        update();
    }

    function update() {
        document.getElementById('u-bal').innerText = stats.balance.toFixed(8);
        document.getElementById('u-spins').innerText = stats.spins;
        if(stats.isAdmin) document.getElementById('admin-btn').style.display = 'flex';
        renderInv();
    }

    function initSession() {
        let u = document.getElementById('user-in').value;
        let p = document.getElementById('pass-in').value;
        if(!u || !document.getElementById('terms-check').checked) return alert("Acepta t√©rminos");

        let saved = localStorage.getItem('smal_master_' + u);
        if(saved) stats = JSON.parse(saved);
        else stats.user = u;

        // LLAVE MAESTRA ADMIN
        if(p === "admin123") stats.isAdmin = true; // Aqu√≠ cambias tu clave admin

        document.getElementById('auth-screen').style.display = 'none';
        save();
        buildGrid();
    }

    function showView(v) {
        document.querySelectorAll('.view').forEach(x => x.style.display = 'none');
        document.getElementById('v-' + v).style.display = 'block';
        document.querySelectorAll('.nav-link').forEach(x => x.classList.remove('active'));
    }

    // --- L√ìGICA MINAS (COPIA STAKE) ---
    function buildGrid() {
        const g = document.getElementById('grid'); g.innerHTML = '';
        for(let i=0; i<25; i++) {
            let t = document.createElement('div');
            t.className = 'tile';
            t.onclick = () => reveal(t, i);
            g.appendChild(t);
        }
    }

    function startMines() {
        let b = parseFloat(document.getElementById('m-bet').value);
        
        // Seguridad: El dinero se resta al inicio
        if(stats.spins > 0) {
            if(confirm("¬øGastar 1 Tiro Gratis?")) { stats.spins--; curBet = b; }
            else { if(stats.balance < b) return; stats.balance -= b; curBet = b; }
        } else {
            if(stats.balance < b) return alert("Saldo insuficiente.");
            stats.balance -= b; curBet = b;
        }

        playing = true; curMult = 1.0; minesArr = [];
        let mCount = document.getElementById('m-count').value;
        while(minesArr.length < mCount) {
            let r = Math.floor(Math.random()*25);
            if(!minesArr.includes(r)) minesArr.push(r);
        }

        document.getElementById('btn-play').disabled = true;
        document.getElementById('btn-cash').style.display = 'block';
        buildGrid();
        save();
    }

    function reveal(el, i) {
        if(!playing || el.classList.contains('revealed')) return;
        el.classList.add('revealed');

        if(minesArr.includes(i)) {
            el.innerHTML = 'üí£'; el.style.background = 'var(--lose)';
            playing = false;
            setTimeout(() => { alert("BOOM! Perdiste."); reset(); }, 100);
        } else {
            el.innerHTML = 'üíé'; el.style.background = 'var(--accent)';
            let step = (25 / (25 - minesArr.length)) * 0.25;
            curMult += step;
            document.getElementById('m-mult').innerText = curMult.toFixed(2) + "x";
            document.getElementById('m-profit').innerText = (curBet * curMult).toFixed(2) + " US$";
        }
    }

    function cashout() {
        let win = curBet * curMult;
        stats.balance += win;

        // SISTEMA DE DROPS DE ITEMS (ADMIN POOL)
        if(curMult > 2.0) {
            stats.pool.forEach(item => {
                if(Math.random()*100 < item.p) {
                    stats.inv.push({n: item.n, d: new Date().toLocaleDateString()});
                    alert("üéÅ DROP ESPECIAL: " + item.n);
                }
            });
        }
        alert("üí∞ Retiraste " + win.toFixed(2));
        reset();
        save();
    }

    function reset() {
        playing = false;
        document.getElementById('btn-play').disabled = false;
        document.getElementById('btn-cash').style.display = 'none';
        document.getElementById('m-mult').innerText = "1.00x";
        document.getElementById('m-profit').innerText = "0.00 US$";
    }

    // --- INVENTARIO Y ADMIN ---
    function renderInv() {
        const list = document.getElementById('inv-list');
        list.innerHTML = stats.inv.length ? '' : '<p>No tienes premios.</p>';
        stats.inv.forEach((it, idx) => {
            list.innerHTML += `
                <div style="background:var(--bg-side); padding:20px; border-radius:8px; border:1px solid var(--accent); text-align:center;">
                    <b>${it.n}</b><br><small>${it.d}</small><br>
                    <button class="btn-bet" style="padding:5px; font-size:0.7rem;" onclick="claim('${it.n}', ${idx})">RECLAMAR</button>
                </div>
            `;
        });
    }

    function claim(name, idx) {
        window.open(`https://wa.me/593987749885?text=Hola Smal, soy ${stats.user} y gan√©: ${name}`);
        stats.inv.splice(idx, 1);
        save();
    }

    function addPoolItem() {
        let n = document.getElementById('adm-name').value;
        let p = document.getElementById('adm-prob').value;
        if(!n || !p) return;
        stats.pool.push({n: n, p: parseInt(p)});
        alert("Item a√±adido a la base de datos.");
        save();
    }
</script>
</body>
</html>
